- name: "Access via ssh"
  hosts: vms
  gather_facts: no
  roles:
    - role: roles/mongo-vm

- name: "No firewalls, no SELinux"
  hosts: vms
  gather_facts: no
  tasks:
  - tags: [ vm, vm.security ]
    ansible.posix.selinux:
      state: disabled
  - tags: [ vm, vm.security ]
    ansible.builtin.service:
      name: firewalld
      state: stopped
      enabled: false

- name: Install k0s
  hosts: vms
  pre_tasks:
   - name: vars/k0s-vars.yml
     tags: always
     include_vars: vars/k0s-vars.yml
  roles:
   - role: epfl-si.k0s
